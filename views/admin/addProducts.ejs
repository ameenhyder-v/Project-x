<%- include("../partials/adminpartials/adminHeader.ejs") %>
<style>
    .container {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px; /* Adjust the gap as needed */
    }  
</style>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
    function addNewRow() {
        // Get the container for the rows
        var container = document.getElementById("rows-container");

        // Get the first row to clone
        var firstRow = document.querySelector(".row-to-clone");

        // Clone the row
        var newRow = firstRow.cloneNode(true);

        // Clear the values in the cloned inputs
        newRow.querySelectorAll("input").forEach(input => input.value = "");
        newRow.querySelectorAll("select").forEach(select => select.selectedIndex = 0);

        // Remove the old event listener from the cloned button (if any)
        var nextButton = newRow.querySelector(".btn-next");
        nextButton.removeEventListener("click", addNewRow);

        // Add a new event listener to the new row's button
        nextButton.addEventListener("click", addNewRow);

        // Append the cloned row to the container
        container.appendChild(newRow);
    }

    document.addEventListener("DOMContentLoaded", function() {
        document.getElementById("next").addEventListener("click", addNewRow);
    });

    function categoryFinding(){
        const selectedGender = document.getElementById('gender');
       // const selectedOption = selectedGender.options[selectedGender.selectedIndex].text;
       const selectedOption = selectedGender.value;
        window.alert(selectedOption)
        console.log('this is issi')

        if (selectedOption) {
            fetch(`/admin/check-category?gender=${selectedOption}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok ' + response.statusText);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Success:', data);
                    const selectElement = document.getElementById('category');
                    selectElement.innerHTML = '';
                    data.forEach(item => {
                        const option = document.createElement('option');
                        option.text = item.category; // Assuming 'category' is the property in your data
                        selectElement.appendChild(option);
                    });
                    // You can handle the data received from the API here
                })
                .catch(error => {
                    console.error('There was a problem with the fetch operation:', error);
                });
        } else {
            alert('Please select a gender');
        }
    }

    //Adding products 
    async function addProduct(){
        try{
            const productName = document.getElementById("productName").value;
            const description = document.getElementById("Description").value;
            const brandName = document.getElementById("brand_name").value;
            const material = document.getElementById("material").value;
            const gender = document.getElementById("gender").value;
            console.log(gender)
            const category = document.getElementById("category").value;
            const tags = document.getElementById("tags").value;


            const response = await fetch('/admin/adding-product',{
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({
                    productName: productName,
                    description: description,
                    brandName: brandName,
                    material: material,
                    gender: gender,
                    category: category,
                    tags: tags
                })


            })

            if (!response.ok) {
            const data = await response.json();
            console.log(data)
            Swal.fire({
                position: "center",
                icon: "warning",
                title: `<span style="color: red;">${data.message}</span>`,
                showConfirmButton: false,
                timer: 1500
                
              });
                
            }
            const data = await response.json();
            $('#variantModal').modal('show');

        } catch(error){
            console.log(error.message)
        }
    }


     function removeProduct() {
        fetch("/admin/remove-product")
    }


    

    async function addVariant() {
        const formData = new FormData(document.getElementById("variantForm"));

        alert("hello world")
        console.log(formData)
        const response = await fetch("/admin/add-variant", {
           method: "POST",
            body: formData
        });

      if (response.ok) {
            console.log("Variant added successfully");
        } else {
            console.error("Error adding variant");
        }
    }
</script>

<div class="screen-overlay"></div>
<aside class="navbar-aside" id="offcanvas_aside">
    <div class="aside-top">
        <a href="index.html" class="brand-wrap">
            <img src="/assets/imgs/theme/logo.svg" class="logo"
                alt="Nest Dashboard" />
        </a>
        <div>
            <button class="btn btn-icon btn-aside-minimize"><i
                    class="text-muted material-icons md-menu_open"></i></button>
        </div>
    </div>
    <nav>
        <ul class="menu-aside">
            <li class="menu-item">
                <a class="menu-link" href="/admin/dashboard">
                    <i class="icon material-icons md-home"></i>
                    <span class="text">Dashboard</span>
                </a>
            </li>
            <li class="menu-item">
                <a class="menu-link" href="/admin/productlist">
                    <i class="icon material-icons md-shopping_bag"></i>
                    <span class="text">Products</span>
                </a>
            </li>

            <li class="menu-item active">
                <a class="menu-link" href="/admin/addProduct">
                    <i class="icon material-icons md-shopping_cart"></i>
                    <span class="text">Add product</span>
                </a>
            </li>

            <li class="menu-item">
                <a class="menu-link" href="/admin/orders">
                    <i class="icon material-icons md-list_alt"></i>
                    <span class="text">Orders</span>
                </a>
            </li>

            <li class="menu-item">
                <a class="menu-link" href="/admin/users">
                    <i class="icon material-icons md-people"></i>
                    <span class="text">Users</span>
                </a>
            </li>

            <li class="menu-item">
                <a class="menu-link" href="/admin/Categories">
                    <i class="icon material-icons md-layers"></i>
                    <span class="text">Categories</span>
                </a>
            </li>

            <li class="menu-item has-submenu">
                <a class="menu-link" href="#">
                    <i class="icon material-icons md-person"></i>
                    <span class="text">Account</span>
                </a>
                <div class="submenu">
                    <a href="page-account-login.html">User login</a>
                    <a href="page-account-register.html">User registration</a>
                    <a href="page-error-404.html">Error 404</a>
                </div>
            </li>
            <li class="menu-item">
                <a class="menu-link" href="page-reviews.html">
                    <i class="icon material-icons md-comment"></i>
                    <span class="text">Reviews</span>
                </a>
            </li>
            <li class="menu-item">
                <a class="menu-link" href="page-brands.html"> <i
                        class="icon material-icons md-stars"></i> <span
                        class="text">Brands</span> </a>
            </li>
            <li class="menu-item">
                <a class="menu-link" disabled href="#">
                    <i class="icon material-icons md-pie_chart"></i>
                    <span class="text">Statistics</span>
                </a>
            </li>
        </ul>
        <hr />
        <ul class="menu-aside">
            <li class="menu-item has-submenu">
                <a class="menu-link" href="#">
                    <i class="icon material-icons md-settings"></i>
                    <span class="text">Settings</span>
                </a>
                <div class="submenu">
                    <a href="page-settings-1.html">Setting sample 1</a>
                    <a href="page-settings-2.html">Setting sample 2</a>
                </div>
            </li>
            <li class="menu-item">
                <a class="menu-link" href="page-blank.html">
                    <i class="icon material-icons md-local_offer"></i>
                    <span class="text"> Starter page </span>
                </a>
            </li>
        </ul>
        <br />
        <br />
    </nav>
</aside>
<main class="main-wrap">
    <header class="main-header navbar">
        <div class="col-search">
            <form class="searchform">
                <div class="input-group">
                    <input list="search_terms" type="text" class="form-control"
                        placeholder="Search term" />
                    <button class="btn btn-light bg" type="button"><i
                            class="material-icons md-search"></i></button>
                </div>
                <datalist id="search_terms">
                    <option value="Products"></option>
                    <option value="New orders"></option>
                    <option value="Apple iphone"></option>
                    <option value="Ahmed Hassan"></option>
                </datalist>
            </form>
        </div>
        <div class="col-nav">
            <button class="btn btn-icon btn-mobile me-auto"
                data-trigger="#offcanvas_aside"><i
                    class="material-icons md-apps"></i></button>
            <ul class="nav">
                <li class="nav-item">
                    <a class="nav-link btn-icon" href="#">
                        <i
                            class="material-icons md-notifications animation-shake"></i>
                        <span class="badge rounded-pill">3</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link btn-icon darkmode" href="#"> <i
                            class="material-icons md-nights_stay"></i> </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="requestfullscreen nav-link btn-icon"><i
                            class="material-icons md-cast"></i></a>
                </li>
                <li class="dropdown nav-item">
                    <a class="dropdown-toggle" data-bs-toggle="dropdown"
                        href="#" id="dropdownLanguage" aria-expanded="false"><i
                            class="material-icons md-public"></i></a>
                    <div class="dropdown-menu dropdown-menu-end"
                        aria-labelledby="dropdownLanguage">
                        <a class="dropdown-item text-brand" href="#"><img
                                src="/assets/imgs/theme/flag-us.png"
                                alt="English" />English</a>
                        <a class="dropdown-item" href="#"><img
                                src="/assets/imgs/theme/flag-fr.png"
                                alt="Français" />Français</a>
                        <a class="dropdown-item" href="#"><img
                                src="/assets/imgs/theme/flag-jp.png"
                                alt="Français" />日本語</a>
                        <a class="dropdown-item" href="#"><img
                                src="/assets/imgs/theme/flag-cn.png"
                                alt="Français" />中国人</a>
                    </div>
                </li>
                <li class="dropdown nav-item">
                    <a class="dropdown-toggle" data-bs-toggle="dropdown"
                        href="#" id="dropdownAccount" aria-expanded="false">
                        <img class="img-xs rounded-circle"
                            src="/assets/imgs/people/avatar-2.png"
                            alt="User" /></a>
                    <div class="dropdown-menu dropdown-menu-end"
                        aria-labelledby="dropdownAccount">
                        <a class="dropdown-item" href="#"><i
                                class="material-icons md-perm_identity"></i>Edit
                            Profile</a>
                        <a class="dropdown-item" href="#"><i
                                class="material-icons md-settings"></i>Account
                            Settings</a>
                        <a class="dropdown-item" href="#"><i
                                class="material-icons md-account_balance_wallet"></i>Wallet</a>
                        <a class="dropdown-item" href="#"><i
                                class="material-icons md-receipt"></i>Billing</a>
                        <a class="dropdown-item" href="#"><i
                                class="material-icons md-help_outline"></i>Help
                            center</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item text-danger" href="#"><i
                                class="material-icons md-exit_to_app"></i>Logout</a>
                    </div>
                </li>
            </ul>
        </div>
    </header>
    <section class="content-main">
        <div class="row">
            <div class="col-9">
                <div class="content-header">
                    <h2 class="content-title">Add New Product</h2>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="card mb-4">
                    <div class="card-header">
                        <h4>Basic</h4>
                    </div>
                    <div class="card-body">
                        <form>
                            <div class="mb-4">
                                <label for="product_name"
                                    class="form-label">Product Name</label>
                                <input type="text" placeholder="Type here" class="form-control" id="productName" required name="name"/>
                            </div>
                            <div class="mb-4">
                                <label class="form-label">Full description</label>
                                <textarea placeholder="Type here" class="form-control" rows="4" name="description" required id="Description"></textarea>
                            </div>
                            <div class="mb-4">
                                <label class="form-label">Brand Name</label>
                                <input type="text" placeholder="Brand Name" class="form-control" id="brand_name" name="brandName">
                            </div>
                            <div class="mb-4">
                                <label class="form-label">Material</label>
                                <input type="text" placeholder="Material" class="form-control" id="material" name="material">
                            </div>
                            <div>
                                <button
                                    class="btn btn-light rounded font-sm mr-5 text-body hover-up">Cancel</button>
                                <button class="btn btn-md rounded font-sm hover-up"  type="button" onclick="addProduct()" >Add Product</button>
                            </div>
                        
                    </div>
                </div>
                <!-- card end// -->

            </div>
            <div class="col-lg-3">
                <div class="card mb-4">
                    <div class="card-header">
                        <h4>Organization</h4>
                    </div>
                    <div class="card-body">
                        <div class="row gx-2">
                            <div class="col-sm-6 mb-3">
                                <label class="form-label">Gender</label>
                                <select class="form-select" onchange="categoryFinding()" name="gender" id="gender">
                                    <option disabled selected hidden>choose..</option>
                                    <option>Male</option>
                                    <option>Female</option>
                                </select>
                            </div>
                            <div class="col-sm-6 mb-3">
                                <label class="form-label">Sub-category</label>
                                <select class="form-select" name="category" id="category">
                                    <option disabled selected hidden>choose..</option> 
                                </select>
                            </div>
                            <div class="mb-4">
                                <label for="product_name"
                                    class="form-label">Tags</label>
                                <input type="text" class="form-control" placeholder="New/Araival" name="tags" id="tags">
                            </div>

                        </div>
                        <!-- row.// -->
                    </div>
                </div>
                <!-- card end// -->

            </div>
        </div>
    </form>
    </section>
    <!-- content-main end// -->

<%- include("../partials/adminpartials/adminFooter") %>

    <!-- modal part  -->
    <div class="modal fade dark" id="variantModal" tabindex="-1"
        aria-labelledby="variantModalLabel" aria-hidden="true">
        <div class="modal-dialog " style="max-width: 600px;">
            <div class="modal-content"
                style="background-color: rgb(68, 68, 68);">
                <div class="modal-header ">
                    <h5 class="modal-title" id="variantModalLabel">Add Product Variants</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" onclick="removeProduct()" aria-label="Close"></button>
                </div>
                <div class="modal-body"
                    style="background-color: rgb(68, 68, 68);">
                    <form id="variantForm">
                        <div class="mb-3">
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h4>Media</h4>
                                </div>
                                <div class="container">
                                    <div class="card-body">
                                        <div class="input-upload">
                                            <img
                                                src="/assets/imgs/theme/upload.svg"
                                                alt />
                                            <input class="form-control"
                                                type="file" name="Image"/>
                                        </div>
                                        </div class="container">
                                        <div class="card-body">
                                            <div class="input-upload">
                                                <img
                                                    src="/assets/imgs/theme/upload.svg"
                                                    alt />
                                                <input class="form-control"
                                                    type="file" name="Image"/>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="input-upload">
                                                <img
                                                    src="/assets/imgs/theme/upload.svg"
                                                    alt />
                                                <input class="form-control"
                                                    type="file" name="Image"/>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="input-upload">
                                                <img
                                                    src="/assets/imgs/theme/upload.svg"
                                                    alt />
                                                <input class="form-control"
                                                    type="file" name="Image"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="variant_name"
                                        class="form-label">Colour</label>
                                    <input type="text" class="form-control"
                                       
                                        placeholder="e.g., Color," name="colour" />
                                </div>
                                <div id="rows-container">
                                    <div class="row gx-4 row-to-clone">
                                        <div class="col-sm-3 mb-3">
                                            <label class="form-label" name="size">Size</label>
                                            <select class="form-select" name="size">
                                                <option>S</option>
                                                <option>M</option>
                                                <option>L</option>
                                                <option>XL</option>
                                            </select>
                                        </div>
                                        <div class="col-sm-3 mb-3">
                                            <label class="form-label">Quantity</label>
                                            <input type="number" name="quantity" class="form-control" placeholder="e.g, quantity.No" />
                                        </div>
                                        <div class="col-sm-3 mb-3">
                                            <label class="form-label">Price</label>
                                            <input type="text" name="price" class="form-control" placeholder="e.g, Rupees" />
                                        </div>
                                        <div class="col-sm-3 mb-3">
                                            <br>
                                            <button type="button" class="btn btn-primary btn-next" id="next">Next</button>
                                        </div>
                                    </div>
                                </div>
                            
                            <ul class="list-group mt-3" id="variantList">
                                <!-- Variant items will be appended here -->
                            </ul>
                        </div>
                        <div class="modal-footer" style="background-color: rgb(68, 68, 68);">
                            <button type="button" class="btn btn-secondary" 
                            data-bs-dismiss="modal" onclick="removeProduct()" >Close</button>
                            <button type="button" class="btn btn-primary" onclick="addVariant()">Save changes</button>
                        </div>
                    </form>
                    </div>
                </div>
    
            </div>
        </div>
    </div>

    